---
layout: ../../../../../layouts/Content.astro
title: "ABC336 D"
problem: https://atcoder.jp/contests/abc336/tasks/abc336_d
---
0-indexed で考える.

ピラミッド数列を増加部分と減少部分に分けてみる.

まずは $A_i$ から $A_{i+x-1}$ までが増加部分になれる最大の $x$ である $X_i$ を求める.

$B_i = A_i - (i + 1)$ という数列を考えて, $\min \{ B_i, B_{i+1}, \dots, B_{i+x-1} \} \geq -i$ であれば増加部分になれる. これは $B_i$ をセグメントツリーに入れておけば計算できる.

また, ある数 $x$ で増加部分になれるなら, $x^{\prime} \lt x$ となる $x^{\prime}$ でも増加部分になれるので, 最大の $x$ は二分探索で求められる.

減少部分についての $X_i$ を $Y_i$ とすると, これは $A_i$ を逆順にした数列で同様に求められる.

次に, 各 $i$ について得られるピラミッド数列の最大値を求める.

これには, $1$ 以上 $\min \{ X_i, \ceil{(N-i)/2} \}$ 以下の数値 $k$ において, $Y_{i+2k-2} \geq k$ ならばピラミッド数列が得られる. ある $k$ でピラミッド数列が得られるなら, $k^{\prime} \lt k$ となる $k^{\prime}$ でもピラミッド数列が得られるので, 最大の $k$ はこれも二分探索で求められる.
