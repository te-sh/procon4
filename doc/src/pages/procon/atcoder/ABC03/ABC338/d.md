---
layout: ../../../../../layouts/Content.astro
title: "ABC338 D"
problem: https://atcoder.jp/contests/abc338/tasks/abc338_d
---
まずは橋が全部有効な状態でのツアーの長さを考える.

$X_i$ から $X_{i+1}$ の移動にかかる長さは $X_i \lt X_{i+1} $ の場合は $L_i = \max \{ \abs{X_{i+1} - X_i}, N - \abs{X_{i+1} - X_i} \}$ となる.

ここで, 島 $a$ と $a + 1$ の間の橋が封鎖されたとする. そうすると, この橋を通るはずだったツアーの順路である $X_i$ と $X_{i+1}$ の移動にかかる長さは $L_i$ から $N-L_i$ に変わるので, ツアーの長さは $\Sigma N-2L_i$ だけ増えることとなる.

これを短時間で計算するためには, 橋が全て有効である場合にツアーで島 $a$ と $a+1$ を通るはずの順路の数とそのルートにかかる長さを保持しておけばいい.

この計算には imos 法を用いれば $O(N)$ で求めることができる.
